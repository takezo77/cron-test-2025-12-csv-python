name: Daily CSV Upload

on:
  schedule:
    - cron: '0 22 * * *'   # 毎日 22:00 UTC → 日本時間 07:00
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:
      - name: リポジトリをチェックアウト
        uses: actions/checkout@v3

      - name: Python をセットアップ
        uses: actions/setup-python@v4
        with:
          python-version: "3.12"

      - name: ライブラリをインストール
        run: pip install -r requirements.txt

      - name: 環境変数から token.json を生成
        run: |
          echo "${GMAIL_TOKEN_JSON}" > token.json
        env:
          GMAIL_TOKEN_JSON: ${{ secrets.GMAIL_TOKEN_JSON }}

      - name: CSVアップロード実行
        env:
          DRIVE_FOLDER_ID: ${{ secrets.DRIVE_FOLDER_ID }}
          GMAIL_TOKEN_JSON: ${{ secrets.GMAIL_TOKEN_JSON }}
        run: python upload_csv.py
